<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>あとだしじゃんけん</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior: none;
        }
        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 4vh 6vw;
        }
        .mode-btn {
            transition: all 0.2s ease-in-out;
        }
        /* モード選択時を緑に変更 */
        .mode-active {
            background-color: #22c55e; /* Tailwindのgreen-500 */
            color: white;
            transform: scale(1.02);
        }
        .noselect {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .text-small {
            font-size: 4rem;
        }
        .text-hand {
            font-size: 13rem;
        }
    </style>
</head>
<body class="bg-stone-100 flex items-center justify-center h-screen overflow-hidden">

    <div class="app-container bg-white rounded-lg shadow-xl">

        <!-- 初期設定画面 -->
        <div id="setupScreen" class="flex flex-col h-full text-center">
            <h1 class="text-4xl lg:text-5xl font-bold mb-6 text-gray-800">あとだしじゃんけん</h1>
            <p class="text-gray-600 mb-8 text-lg lg:text-xl">モードをえらんでね</p>

            <div class="flex flex-col space-y-4 flex-grow justify-center max-w-md mx-auto w-full">
                <button id="winBtn" data-mode="win" class="mode-btn w-full p-5 rounded-lg text-xl font-semibold bg-green-200 text-gray-800 hover:bg-green-300">かってね</button>
                <button id="loseBtn" data-mode="lose" class="mode-btn w-full p-5 rounded-lg text-xl font-semibold bg-green-200 text-gray-800 hover:bg-green-300">まけてね</button>
                <button id="drawBtn" data-mode="draw" class="mode-btn w-full p-5 rounded-lg text-xl font-semibold bg-green-200 text-gray-800 hover:bg-green-300">おなじの</button>
                <button id="randomBtn" data-mode="random" class="mode-btn w-full p-5 rounded-lg text-xl font-semibold bg-green-200 text-gray-800 hover:bg-green-300">ランダム</button>
            </div>

            <!-- スタートボタンを青に変更 -->
            <button id="startBtn" class="w-full max-w-md mx-auto p-5 mt-10 rounded-lg text-xl font-semibold bg-blue-500 text-white hover:bg-blue-600 disabled:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition" disabled>
                スタート
            </button>
        </div>

        <!-- ゲーム画面 -->
        <div id="gameScreen" class="hidden flex-col h-full text-center relative">
            <a href="#" id="backBtn" class="absolute bottom-4 left-4 text-gray-500 hover:underline text-lg z-10">もどる</a>
            <div id="modeDisplay" class="text-4xl font-bold text-blue-600 h-12 mb-8"></div>
            <div class="flex-grow flex flex-col items-center justify-center noselect">
                <div id="jankenDisplay" class="text-hand font-bold my-4 h-52 flex items-center justify-center text-indigo-800"></div>
            </div>
            <button id="nextStepBtn" class="bg-transparent text-green-500 text-4xl font-bold hover:text-green-600 disabled:text-gray-300 transition mx-auto mt-6">▶</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const HANDS = ['✊', '✌️', '✋'];
            const MODES = { win: 'かってね', lose: 'まけてね', draw: 'おなじの' };
            const MODE_KEYS = Object.keys(MODES);

            let currentMode = null;
            let displayMode = null;
            let computerHandIndex = null;
            let isGameRunning = false;

            const setupScreen = document.getElementById('setupScreen');
            const gameScreen = document.getElementById('gameScreen');
            const modeButtons = document.querySelectorAll('.mode-btn');
            const startBtn = document.getElementById('startBtn');
            const modeDisplay = document.getElementById('modeDisplay');
            const jankenDisplay = document.getElementById('jankenDisplay');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const backBtn = document.getElementById('backBtn');

            function resetGameDisplay() {
                modeDisplay.textContent = '';
                jankenDisplay.textContent = '';
                computerHandIndex = null;
                nextStepBtn.disabled = false;
                isGameRunning = false;
            }

            async function runFullGameSequence() {
                isGameRunning = true;
                nextStepBtn.disabled = true;
                jankenDisplay.textContent = '';

                if (currentMode === 'random') {
                    const randomKey = MODE_KEYS[Math.floor(Math.random() * MODE_KEYS.length)];
                    displayMode = MODES[randomKey];
                } else {
                    displayMode = MODES[currentMode];
                }
                modeDisplay.textContent = '';

                // モード名を小さく表示（1秒ごとに切り替え）
                jankenDisplay.classList.remove('text-hand');
                jankenDisplay.classList.add('text-small');
                jankenDisplay.textContent = displayMode;
                await new Promise(r => setTimeout(r, 1000));
                if (!isGameRunning) return;

                // 「じゃん」
                jankenDisplay.textContent = 'じゃん';
                await new Promise(r => setTimeout(r, 1000));
                if (!isGameRunning) return;

                // 「けん」
                jankenDisplay.textContent = 'けん';
                await new Promise(r => setTimeout(r, 1000));
                if (!isGameRunning) return;

                // 手を表示（大）
                computerHandIndex = Math.floor(Math.random() * HANDS.length);
                jankenDisplay.classList.remove('text-small');
                jankenDisplay.classList.add('text-hand');
                jankenDisplay.textContent = `${HANDS[computerHandIndex]}`;
                await new Promise(r => setTimeout(r, 1000));
                if (!isGameRunning) return;

                isGameRunning = false;
                nextStepBtn.disabled = false;
            }

            modeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentMode = button.dataset.mode;
                    modeButtons.forEach(btn => {
                        btn.classList.remove('mode-active');
                        btn.classList.add('bg-green-200', 'text-gray-800');
                    });
                    button.classList.add('mode-active');
                    button.classList.remove('bg-green-200', 'text-gray-800');
                    startBtn.disabled = false;
                });
            });

            startBtn.addEventListener('click', () => {
                if (currentMode) {
                    setupScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    gameScreen.classList.add('flex');
                    runFullGameSequence();
                }
            });

            nextStepBtn.addEventListener('click', () => {
                if (!nextStepBtn.disabled) {
                    runFullGameSequence();
                }
            });

            backBtn.addEventListener('click', (e) => {
                e.preventDefault();
                isGameRunning = false;
                gameScreen.classList.add('hidden');
                gameScreen.classList.remove('flex');
                setupScreen.classList.remove('hidden');
                currentMode = null;
                startBtn.disabled = true;
                modeButtons.forEach(btn => {
                    btn.classList.remove('mode-active');
                    btn.classList.add('bg-green-200', 'text-gray-800');
                });
                resetGameDisplay();
            });
        });
    </script>
</body>
</html>
